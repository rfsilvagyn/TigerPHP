<?php

class Permissoes extends Model {
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //VARIAVEIS PRIVADAS
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  private $grupo;
  private $permissoes;
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //PREENCHE AS PERMISSOES DE ACORDO COM O GRUPO DO USUARIO
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  public function setarGrupo($id, $tb_empresas_id) {
    $this->grupo = $id;
    $this->permissoes = array();

    $sql = "SELECT parametros FROM tb_gruposusuarios WHERE id = :id AND tb_empresas_id = :tb_empresas_id";
    $sql = $this->db->prepare($sql);
    $sql->bindValue(':id', $id);
    $sql->bindValue(':tb_empresas_id', $tb_empresas_id);
    $sql->execute();

    if ($sql->rowCount() > 0) {
      $registro = $sql->fetch();

      if (empty($registro['parametros'])) {
        $registro['parametros'] = '0';
      }

      $parametros = $registro['parametros'];

      $sql = "SELECT nome FROM tb_permissoesusuarios WHERE id IN ($parametros) AND tb_empresas_id = :tb_empresas_id";
      $sql = $this->db->prepare($sql);
      $sql->bindValue(':tb_empresas_id', $tb_empresas_id);
      $sql->execute();

      if ($sql->rowCount() > 0) {
        foreach($sql->fetchAll() as $item) {
          $this->permissoes[] = $item['nome'];
        }
      }
    }
  }
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //VERIFICA SE USUARIO TEM PERMISSAO
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  public function temPermissao($nome) {
    if (in_array($nome, $this->permissoes)) {
      return true;
    } else {
      return false;
    }
  }
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //OBTER TODAS AS PERMISSOES
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  public function obterTodos($tb_empresas_id) {
    $array = array();

    $sql = "SELECT * FROM tb_permissoesusuarios WHERE tb_empresas_id = :tb_empresas_id";
    $sql = $this->db->prepare($sql);
    $sql->bindValue(':tb_empresas_id', $tb_empresas_id);
    $sql->execute();

    if ($sql->rowCount() > 0) {
      $array = $sql->fetchAll();
    }
    return $array;
  }
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //ADICIONAR PERMISSAO
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  public function adicionar($nome, $tb_empresas_id) {
    $sql = "INSERT INTO tb_permissoesusuarios SET nome = :nome, tb_empresas_id = :tb_empresas_id";
    $sql = $this->db->prepare($sql);
    $sql->bindValue(':nome', $nome);
    $sql->bindValue(':tb_empresas_id', $tb_empresas_id);
    $sql->execute();
  }
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //DELETAR PERMISSAO
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  public function deletar($id) {
    $sql = "DELETE FROM tb_permissoesusuarios WHERE id = :id";
    $sql = $this->db->prepare($sql);
    $sql->bindValue(':id', $id);
    $sql->execute();
  }
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  //
  ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



}
?>
